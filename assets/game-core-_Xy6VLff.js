var b=Object.defineProperty;var z=(e,t,i)=>t in e?b(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var o=(e,t,i)=>z(e,typeof t!="symbol"?t+"":t,i);import{_ as T,a as c,b as I,c as m,d as E,e as C,f as S,g as V,h as g,i as k,j as A,k as u,l as y,m as P,n as x}from"./vendor-DBPU9Icq.js";import{M as W,a as H}from"./mini-arcade-NxSwJdup.js";class f{}o(f,"instance");class G extends T{constructor(t){super(t)}initializeAsync(){return W.awaitNextFrameAsync()}requireIsInitialized(){if(!this.isInitialized)throw new Error("Error this.isInitialized")}}var l=(e=>(e[e.Pixel=0]="Pixel",e[e.Percent=1]="Percent",e))(l||{}),_=(e=>(e[e.ImageSource=0]="ImageSource",e[e.Screen=1]="Screen",e))(_||{}),v=(e=>(e[e.Ignore=0]="Ignore",e[e.PrioritizeWidth=1]="PrioritizeWidth",e[e.PrioritizeHeight=2]="PrioritizeHeight",e))(v||{});const F={width:{value:100,unit:1},height:{value:100,unit:1},relativeTo:0,scaleAspectRatio:0},M={x:{value:50,unit:1},y:{value:50,unit:1},relativeTo:1},L={sizeLayoutConfiguration:F,positionLayoutConfiguration:M};class d{constructor(t=L){o(this,"_configuration");this._configuration=t}get configuration(){return this._configuration}screenWidthCurrent(){return f.instance.screen.resolution.width}screenHeightCurrent(){return f.instance.screen.resolution.height}screenWidthOriginal(){return f.instance.screen.canvasWidth}screenHeightOriginal(){return f.instance.screen.canvasHeight}screenWidthFactor(){return this.screenWidthCurrent()/this.screenWidthOriginal()}screenHeightFactor(){return this.screenHeightCurrent()/this.screenHeightOriginal()}getCalculatedWidth(t){let i=-1;switch(this.validateConfiguration(t),this._configuration.sizeLayoutConfiguration.relativeTo){case 1:this._configuration.sizeLayoutConfiguration.width.unit===1?i=this.screenWidthCurrent()*(this._configuration.sizeLayoutConfiguration.width.value/100):this._configuration.sizeLayoutConfiguration.width.unit===0&&(i=this._configuration.sizeLayoutConfiguration.width.value);break;case 0:t&&(this._configuration.sizeLayoutConfiguration.width.unit===1?i=t.width*(this._configuration.sizeLayoutConfiguration.width.value/100):this._configuration.sizeLayoutConfiguration.width.unit===0&&(i=this._configuration.sizeLayoutConfiguration.width.value));break;default:throw new Error("Invalid relativeTo configuration")}return i}getCalculatedHeight(t){let i=-1;switch(this.validateConfiguration(t),this._configuration.sizeLayoutConfiguration.relativeTo){case 1:this._configuration.sizeLayoutConfiguration.height.unit===1?i=this.screenHeightCurrent()*(this._configuration.sizeLayoutConfiguration.height.value/100):this._configuration.sizeLayoutConfiguration.height.unit===0&&(i=this._configuration.sizeLayoutConfiguration.height.value);break;case 0:t&&(this._configuration.sizeLayoutConfiguration.height.unit===1?i=t.height*(this._configuration.sizeLayoutConfiguration.height.value/100):this._configuration.sizeLayoutConfiguration.height.unit===0&&(i=this._configuration.sizeLayoutConfiguration.height.value));break;default:throw new Error("Invalid relativeTo configuration")}return i}getCalculatedScale(t){this.validateConfiguration(t);const i=this.getCalculatedWidth(t),n=this.getCalculatedHeight(t);switch(this._configuration.sizeLayoutConfiguration.scaleAspectRatio){case 0:return new c(i/t.width,n/t.height);case 1:const r=i/(t.width/t.height);return new c(i/t.width,r/t.height);case 2:const s=n*(t.width/t.height);return new c(s/t.width,n/t.height);default:throw new Error("Invalid aspect ratio configuration")}}getCalculatedPosition(t){let i=new c(0,0);if(!this._configuration.positionLayoutConfiguration)return i;switch(this.validateConfiguration(t),this._configuration.positionLayoutConfiguration.relativeTo){case 1:this._configuration.positionLayoutConfiguration.x.unit===1?i.x=this.screenWidthCurrent()*(this._configuration.positionLayoutConfiguration.x.value/100):this._configuration.positionLayoutConfiguration.x.unit===0&&(i.x=this._configuration.positionLayoutConfiguration.x.value),this._configuration.positionLayoutConfiguration.y.unit===1?i.y=this.screenHeightCurrent()*(this._configuration.positionLayoutConfiguration.y.value/100):this._configuration.positionLayoutConfiguration.y.unit===0&&(i.y=this._configuration.positionLayoutConfiguration.y.value);break;case 0:t&&(this._configuration.positionLayoutConfiguration.x.unit===1?i.x=t.width*(this._configuration.positionLayoutConfiguration.x.value/100):this._configuration.positionLayoutConfiguration.x.unit===0&&(i.x=this._configuration.positionLayoutConfiguration.x.value),this._configuration.positionLayoutConfiguration.y.unit===1?i.y=t.height*(this._configuration.positionLayoutConfiguration.y.value/100):this._configuration.positionLayoutConfiguration.y.unit===0&&(i.y=this._configuration.positionLayoutConfiguration.y.value));break;default:throw new Error("Invalid relativeTo  configuration")}return i}validateConfiguration(t){if(this._configuration.sizeLayoutConfiguration.relativeTo==0&&!t)throw new Error(`${this.constructor.name}. size is required when relativeTo = ${this._configuration.sizeLayoutConfiguration.relativeTo}`)}}o(d,"RetroFactor",Math.round(Math.random()*2)+1);class p extends I{constructor(i){const n=new m({text:"",font:new E({size:20+10/d.RetroFactor,color:C.White,unit:S.Px,family:"Britanic",style:V.Normal,bold:!1,textAlign:g.Left,baseAlign:k.Alphabetic,direction:A.LeftToRight,shadow:{blur:2,offset:u(1,1),color:C.Blue}})});n.anchor=u(0,0),n.pos=u(0,0);super();o(this,"_label");o(this,"MarginTop",40);o(this,"MarginLeft",40);o(this,"MarginBottom",20);o(this,"_layoutEngine");const r={sizeLayoutConfiguration:{width:{value:10,unit:l.Percent},height:{value:10,unit:l.Percent},relativeTo:_.Screen,scaleAspectRatio:v.PrioritizeWidth},positionLayoutConfiguration:{x:{value:50,unit:l.Pixel},y:{value:50,unit:l.Pixel},relativeTo:_.Screen}};this._layoutEngine=new d(r),this._engine=i,this._label=n}get text(){return this._label.text}set text(i){this._label.text=i}onInitialize(){this.addChild(this._label)}anchorToUpperLeft(i){this._label.font.textAlign=g.Left,this.pos=u(this._label.width/2+i,this._label.height+this.MarginTop+i)}anchorToUpperRight(i){this._label.font.textAlign=g.Right,this.pos=u(this._engine.drawWidth-this._label.width/2-i,-2+this._label.height+this.MarginTop+i)}anchorToLowerLeft(i){this._label.font.textAlign=g.Left,this.pos=u(this._label.width/2+i,this._engine.drawHeight-this.MarginBottom-i)}anchorToLowerRight(i){this._label.font.textAlign=g.Right,this.pos=u(this._engine.drawWidth-this._label.width/2-i,this._engine.drawHeight-this.MarginBottom-i)}anchorToCenter(i){this._label.font.textAlign=g.Center,this.pos=u(this._engine.drawWidth/2+this._label.width/2,this._engine.drawHeight/2-this._label.height/2)}}class U extends y{constructor(i){super();o(this,"_scoreText");o(this,"_livesText");o(this,"_buttonsText");this._scoreText=new p(i),this._livesText=new p(i),this._buttonsText=new p(i)}set scoreText(i){this._scoreText.text=i}set livesText(i){this._livesText.text=i}set buttonsText(i){this._buttonsText.text=i}onInitialize(){this.addChild(this._scoreText),this.addChild(this._livesText),this.addChild(this._buttonsText),this._scoreText.anchorToUpperLeft(30),this._livesText.anchorToUpperRight(30),this._buttonsText.anchorToLowerLeft(30)}}class j extends y{async initializeAsync(){if(this.isInitialized)return Promise.resolve()}requireIsInitialized(){if(!this.isInitialized)throw new Error("Error this.isInitialized")}}class Z{constructor(){o(this,"_isInitialized",!1)}get isInitialized(){return this._isInitialized}async initializeAsync(){if(this.isInitialized)return Promise.resolve();this._isInitialized=!0}requireIsInitialized(){if(!this.isInitialized)throw new Error("Error this.isInitialized")}}class J{constructor(t){o(this,"onValueChanged");o(this,"_currentValue");o(this,"_previousValue");if(this.onValueChanged=new R,t!==void 0)this._currentValue=t,this._previousValue=t;else throw new Error("Initial value must be provided")}get value(){return this._currentValue}set value(t){this._currentValue=this.onValueChanging(this._currentValue,t),this._previousValue!=this._currentValue&&(this._previousValue=this._currentValue,this.onValueChanged.invoke(this._previousValue,this._currentValue))}onValueChanging(t,i){return i}refreshValueChanged(){this.onValueChanged.refresh(this._previousValue,this._currentValue)}}class B{constructor(){o(this,"listeners",{})}on(t,i){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(i)}off(t,i){this.listeners[t]&&(this.listeners[t]=this.listeners[t].filter(n=>n!==i))}emit(t,...i){this.listeners[t]&&this.listeners[t].forEach(n=>n(...i))}}class R{constructor(){o(this,"eventEmitter",new B);o(this,"eventName","valueChanged")}addEventListener(t){this.eventEmitter.on(this.eventName,t)}removeEventListener(t){this.eventEmitter.off(this.eventName,t)}invoke(t,i){this.eventEmitter.emit(this.eventName,t,i)}refresh(t,i){this.invoke(t,i)}}class K{constructor(){o(this,"_isInitialized",!1)}get isInitialized(){return this._isInitialized}async initializeAsync(){if(this.isInitialized)return Promise.resolve();this._isInitialized=!0}requireIsInitialized(){if(!this.isInitialized)throw new Error("Error this.isInitialized")}}class Q{constructor(){o(this,"_isInitialized",!1);o(this,"resources",{});o(this,"_loader");this._loader=new P}get loader(){return this._loader}get isInitialized(){return this._isInitialized}async initializeAsync(){this._isInitialized||(this._isInitialized=!0)}requireIsInitialized(){if(!this._isInitialized)throw new Error("ResourceCollection is not initialized. Call initializeAsync() first.")}nameOf(t){let i;if(typeof t=="object"&&t.default)i=t.default;else if(typeof t=="string")i=t;else throw new Error("Invalid import path");const n=i.match(/([^\/]+)(?=\.\w+$)/);return n?n[0]:i}add(t,i,n,r){let s;if(n?s=n:typeof t=="string"?s=this.nameOf(t):s=this.nameOf(t),this.has(s))throw new Error(`${this.constructor.name}.add() Failed. Name '${s}' already exists.`);i instanceof x&&r?this.resources[s]=new x(i.path,s,r):this.resources[s]=i,this.loader.addResource(this.resources[s])}has(t){return t in this.resources}get(t){if(!this.has(t))throw new Error(`${this.constructor.name}.get() Failed. Name '${t}' not found.`);const i=this.resources[t];if(!i)throw new Error(`${this.constructor.name}.get() Failed. Resource '${i}' not found.`);return i}getAll(){return this.resources}}class $ extends y{constructor(i){let n;i.layoutConfiguration?n=new d(i.layoutConfiguration):n=new d(L),i.width||(i.width=n.getCalculatedWidth(i.imageSource)),i.height||(i.height=n.getCalculatedHeight(i.imageSource)),i.pos||(i.pos=n.getCalculatedPosition(i.imageSource));super(i);o(this,"_layoutEngine");o(this,"_configuration");this._configuration=i,this._layoutEngine=n}get configuration(){return this._configuration}get layoutEngine(){return this._layoutEngine}}const D={isScrolling:!1,scrollVelocity:u(0,0),imageSource:H.get("Background03"),layoutConfiguration:{sizeLayoutConfiguration:{width:{value:100,unit:l.Percent},height:{value:100,unit:l.Percent},relativeTo:_.Screen,scaleAspectRatio:v.Ignore},positionLayoutConfiguration:{x:{value:50,unit:l.Percent},y:{value:50,unit:l.Percent},relativeTo:_.Screen}}};class X extends ${constructor(i){i={...D,...i};super(i);o(this,"_offsetTemp",c.Zero);o(this,"_scrollSprite");o(this,"_scrollVelocity");o(this,"_isScrolling",!1);o(this,"_opacity",1);this._scrollVelocity=this.configuration.scrollVelocity??c.Zero,this._isScrolling=this.configuration.isScrolling??!1,this.z=-1,this.graphics.onPreDraw=this.Graphics_onPreDraw.bind(this)}get configuration(){return this._configuration}get scrollVelocity(){return this._scrollVelocity}set scrollVelocity(i){this._scrollVelocity=i}get opacity(){return this._opacity}set opacity(i){this._opacity=i}async onInitialize(i){this._scrollSprite=this.configuration.imageSource.toSprite(),this._scrollSprite.width=this.layoutEngine.getCalculatedWidth(this.configuration.imageSource),this._scrollSprite.height=this.layoutEngine.getCalculatedHeight(this.configuration.imageSource),this._isScrolling||this.graphics.add(this._scrollSprite)}Graphics_onPreDraw(i,n){if(!this._isScrolling||!this._scrollSprite)return;i.save();const r=this._scrollVelocity.negate();this._offsetTemp=this._offsetTemp.add(r.scale(n/1e3));const s=(h,a)=>(h%a+a)%a;this._offsetTemp=new c(s(this._offsetTemp.x,this.width),s(this._offsetTemp.y,this.height)),i.opacity=this._opacity,i.translate(-this._offsetTemp.x,-this._offsetTemp.y);for(let h=-1;h<=1;h++)for(let a=-1;a<=1;a++)this._scrollSprite.draw(i,h*this.width,a*this.height);i.restore()}}class Y{static resizeSpriteWithin(t,i,n){const r=t.width/t.height,s=i/n;let h,a;r>s?(h=i,a=i/r):(a=n,h=n*r);const w=t.clone();return w.width=h,w.height=a,w}}export{$ as A,j as B,f as E,G,d as L,U as M,J as O,Q as R,Y as S,l as U,Z as a,K as b,_ as c,v as d,X as e};
