var z=Object.defineProperty;var L=(e,t,i)=>t in e?z(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var s=(e,t,i)=>L(e,typeof t!="symbol"?t+"":t,i);import{_ as u,a as p,b,c as y,d as r,e as I,f as T,g as E,h as m,i as v,j as V,k,l,m as A,n as W}from"./vendor-CMquXB_j.js";import{a as S,M as H}from"./mini-arcade-DfmZk3o-.js";class g{}s(g,"instance");var f=(e=>(e[e.Pixel=0]="Pixel",e[e.Percent=1]="Percent",e))(f||{}),d=(e=>(e[e.ImageSource=0]="ImageSource",e[e.Screen=1]="Screen",e))(d||{}),C=(e=>(e[e.Ignore=0]="Ignore",e[e.PrioritizeWidth=1]="PrioritizeWidth",e[e.PrioritizeHeight=2]="PrioritizeHeight",e))(C||{});const P={width:{value:100,unit:1},height:{value:100,unit:1},relativeTo:0,scaleAspectRatio:0},B={x:{value:50,unit:1},y:{value:50,unit:1},relativeTo:1},x={sizeLayoutConfiguration:P,positionLayoutConfiguration:B};class w{constructor(t=x){s(this,"_configuration");this._configuration=t}get configuration(){return this._configuration}screenWidthCurrent(){return g.instance.screen.resolution.width}screenHeightCurrent(){return g.instance.screen.resolution.height}screenWidthOriginal(){return g.instance.screen.canvasWidth}screenHeightOriginal(){return g.instance.screen.canvasHeight}screenWidthFactor(){return this.screenWidthCurrent()/this.screenWidthOriginal()}screenHeightFactor(){return this.screenHeightCurrent()/this.screenHeightOriginal()}getCalculatedWidth(t){let i=-1;if(this._configuration.sizeLayoutConfiguration.relativeTo==0&&!t)throw new Error(`${this.constructor.name}. ImageSource is required when relativeTo is ImageSource`);switch(this._configuration.sizeLayoutConfiguration.relativeTo){case 1:this._configuration.sizeLayoutConfiguration.width.unit===1?i=this.screenWidthCurrent()*(this._configuration.sizeLayoutConfiguration.width.value/100):this._configuration.sizeLayoutConfiguration.width.unit===0&&(i=this._configuration.sizeLayoutConfiguration.width.value);break;case 0:t.toSprite(),t&&(this._configuration.sizeLayoutConfiguration.width.unit===1?i=t.width*(this._configuration.sizeLayoutConfiguration.width.value/100):this._configuration.sizeLayoutConfiguration.width.unit===0&&(i=this._configuration.sizeLayoutConfiguration.width.value));break;default:throw new Error("Invalid relativeTo configuration")}return i}getCalculatedHeight(t){let i=-1;if(this._configuration.sizeLayoutConfiguration.relativeTo==0&&!t)throw new Error(`${this.constructor.name}. ImageSource is required when relativeTo is ImageSource`);switch(this._configuration.sizeLayoutConfiguration.relativeTo){case 1:this._configuration.sizeLayoutConfiguration.height.unit===1?i=this.screenHeightCurrent()*(this._configuration.sizeLayoutConfiguration.height.value/100):this._configuration.sizeLayoutConfiguration.height.unit===0&&(i=this._configuration.sizeLayoutConfiguration.height.value);break;case 0:t.toSprite(),t&&(this._configuration.sizeLayoutConfiguration.height.unit===1?i=t.height*(this._configuration.sizeLayoutConfiguration.height.value/100):this._configuration.sizeLayoutConfiguration.height.unit===0&&(i=this._configuration.sizeLayoutConfiguration.height.value));break;default:throw new Error("Invalid relativeTo configuration")}return i}getCalculatedScale(t){if(this._configuration.sizeLayoutConfiguration.relativeTo==0&&!t)throw new Error(`${this.constructor.name}. ImageSource is required when relativeTo is ImageSource`);const i=this.getCalculatedWidth(t),n=this.getCalculatedHeight(t);switch(this._configuration.sizeLayoutConfiguration.scaleAspectRatio){case 0:return new u(i/t.width,n/t.height);case 1:const a=i/(t.width/t.height);return new u(i/t.width,a/t.height);case 2:const o=n*(t.width/t.height);return new u(o/t.width,n/t.height);default:throw new Error("Invalid aspect ratio configuration")}}getCalculatedPosition(t){let i=new u(0,0);if(!this._configuration.positionLayoutConfiguration)return i;if(this._configuration.positionLayoutConfiguration.relativeTo==0&&!t)throw new Error(`${this.constructor.name}. ImageSource is required when relativeTo is ImageSource`);switch(this._configuration.positionLayoutConfiguration.relativeTo){case 1:this._configuration.positionLayoutConfiguration.x.unit===1?i.x=this.screenWidthCurrent()*(this._configuration.positionLayoutConfiguration.x.value/100):this._configuration.positionLayoutConfiguration.x.unit===0&&(i.x=this._configuration.positionLayoutConfiguration.x.value),this._configuration.positionLayoutConfiguration.y.unit===1?i.y=this.screenHeightCurrent()*(this._configuration.positionLayoutConfiguration.y.value/100):this._configuration.positionLayoutConfiguration.y.unit===0&&(i.y=this._configuration.positionLayoutConfiguration.y.value);break;case 0:t.toSprite(),t&&(this._configuration.positionLayoutConfiguration.x.unit===1?i.x=t.width*(this._configuration.positionLayoutConfiguration.x.value/100):this._configuration.positionLayoutConfiguration.x.unit===0&&(i.x=this._configuration.positionLayoutConfiguration.x.value),this._configuration.positionLayoutConfiguration.y.unit===1?i.y=t.height*(this._configuration.positionLayoutConfiguration.y.value/100):this._configuration.positionLayoutConfiguration.y.unit===0&&(i.y=this._configuration.positionLayoutConfiguration.y.value));break;default:throw new Error("Invalid relativeTo  configuration")}return i}}class F extends p{constructor(i){let n;i.layoutConfiguration?n=new w(i.layoutConfiguration):n=new w(x),i.width||(i.width=n.getCalculatedWidth(i.imageSource)),i.height||(i.height=n.getCalculatedHeight(i.imageSource)),i.pos||(i.pos=n.getCalculatedPosition(i.imageSource));super(i);s(this,"_layoutEngine");s(this,"_configuration");this._configuration=i,this._layoutEngine=n}get configuration(){return this._configuration}get layoutEngine(){return this._layoutEngine}}class N{constructor(){s(this,"_isInitialized",!1);s(this,"resources",{});s(this,"_loader");this._loader=new b}get loader(){return this._loader}get isInitialized(){return this._isInitialized}async initializeAsync(){this._isInitialized||(this._isInitialized=!0)}requireIsInitialized(){if(!this._isInitialized)throw new Error("ResourceCollection is not initialized. Call initializeAsync() first.")}nameOf(t){let i;if(typeof t=="object"&&t.default)i=t.default;else if(typeof t=="string")i=t;else throw new Error("Invalid import path");const n=i.match(/([^\/]+)(?=\.\w+$)/);return n?n[0]:i}add(t,i,n,a){let o;if(n?o=n:typeof t=="string"?o=this.nameOf(t):o=this.nameOf(t),this.has(o))throw new Error(`${this.constructor.name}.add() Failed. Name '${o}' already exists.`);i instanceof y&&a?this.resources[o]=new y(i.path,o,a):this.resources[o]=i,this.loader.addResource(this.resources[o])}has(t){return t in this.resources}get(t){if(!this.has(t))throw new Error(`${this.constructor.name}.get() Failed. Name '${t}' not found.`);const i=this.resources[t];if(!i)throw new Error(`${this.constructor.name}.get() Failed. Resource '${i}' not found.`);return i}getAll(){return this.resources}}const M={isScrolling:!1,scrollVelocity:r(0,0),imageSource:S.get("Background03"),layoutConfiguration:{sizeLayoutConfiguration:{width:{value:100,unit:f.Percent},height:{value:100,unit:f.Percent},relativeTo:d.Screen,scaleAspectRatio:C.Ignore},positionLayoutConfiguration:{x:{value:50,unit:f.Percent},y:{value:50,unit:f.Percent},relativeTo:d.Screen}}};class G extends F{constructor(i){i={...M,...i};super(i);s(this,"_offsetTemp",u.Zero);s(this,"_scrollSprite");s(this,"_scrollVelocity");s(this,"_isScrolling",!1);s(this,"_opacity",1);this._scrollVelocity=this.configuration.scrollVelocity??u.Zero,this._isScrolling=this.configuration.isScrolling??!1,this.z=-1,this.graphics.onPreDraw=this.Graphics_onPreDraw.bind(this)}get configuration(){return this._configuration}get scrollVelocity(){return this._scrollVelocity}set scrollVelocity(i){this._scrollVelocity=i}get opacity(){return this._opacity}set opacity(i){this._opacity=i}async onInitialize(i){this._scrollSprite=this.configuration.imageSource.toSprite(),this._scrollSprite.width=this.layoutEngine.getCalculatedWidth(this.configuration.imageSource),this._scrollSprite.height=this.layoutEngine.getCalculatedHeight(this.configuration.imageSource),this._isScrolling||this.graphics.add(this._scrollSprite)}Graphics_onPreDraw(i,n){if(!this._isScrolling||!this._scrollSprite)return;i.save();const a=this._scrollVelocity.negate();this._offsetTemp=this._offsetTemp.add(a.scale(n/1e3));const o=(c,h)=>(c%h+h)%h;this._offsetTemp=new u(o(this._offsetTemp.x,this.width),o(this._offsetTemp.y,this.height)),i.opacity=this._opacity,i.translate(-this._offsetTemp.x,-this._offsetTemp.y);for(let c=-1;c<=1;c++)for(let h=-1;h<=1;h++)this._scrollSprite.draw(i,c*this.width,h*this.height);i.restore()}}class U extends I{constructor(t){super(t)}initializeAsync(){return H.AwaitNextFrameAsync()}requireIsInitialized(){if(!this.isInitialized)throw new Error("Error this.isInitialized")}}class _ extends T{constructor(i){const a=20+20/new w().screenWidthFactor(),o=new E({text:"",font:new m({size:a,color:v.White,unit:V.Px,family:"Britanic",style:k.Normal,bold:!1,textAlign:l.Left,baseAlign:A.Alphabetic,direction:W.LeftToRight,shadow:{blur:2,offset:r(1,1),color:v.Blue}}),pos:r(0,0)});super({width:o.getTextWidth(),height:200});s(this,"_label");s(this,"MarginTop",40);s(this,"MarginLeft",40);s(this,"MarginBottom",20);this._engine=i,this._label=o,this.anchor=r(.5,.5)}get text(){return this._label.text}set text(i){this._label.text=i}onInitialize(){this.addChild(this._label)}anchorToUpperLeft(i){this._label.font.textAlign=l.Left,this.pos=r(this._label.width/2+i,this._label.height+this.MarginTop+i)}anchorToUpperRight(i){this._label.font.textAlign=l.Right,this.pos=r(this._engine.drawWidth-this._label.width/2-i,-2+this._label.height+this.MarginTop+i)}anchorToLowerLeft(i){this._label.font.textAlign=l.Left,this.pos=r(this._label.width/2+i,this._engine.drawHeight-this.MarginBottom-i)}anchorToLowerRight(i){this._label.font.textAlign=l.Right,this.pos=r(this._engine.drawWidth-this._label.width/2-i,this._engine.drawHeight-this.MarginBottom-i)}anchorToCenter(i){this._label.font.textAlign=l.Center,this.pos=r(this._engine.drawWidth/2+this._label.width/2,this._engine.drawHeight/2-this._label.height/2)}}class j extends p{constructor(i){super();s(this,"_scoreText");s(this,"_livesText");s(this,"_buttonsText");this._scoreText=new _(i),this._livesText=new _(i),this._buttonsText=new _(i)}set scoreText(i){this._scoreText.text=i}set livesText(i){this._livesText.text=i}set buttonsText(i){this._buttonsText.text=i}onInitialize(){this.addChild(this._scoreText),this.addChild(this._livesText),this.addChild(this._buttonsText),this._scoreText.anchorToUpperLeft(30),this._livesText.anchorToUpperRight(30),this._buttonsText.anchorToLowerLeft(30)}}class Z extends p{async initializeAsync(){if(this.isInitialized)return Promise.resolve()}requireIsInitialized(){if(!this.isInitialized)throw new Error("Error this.isInitialized")}}class J{constructor(){s(this,"_isInitialized",!1)}get isInitialized(){return this._isInitialized}async initializeAsync(){if(this.isInitialized)return Promise.resolve();this._isInitialized=!0}requireIsInitialized(){if(!this.isInitialized)throw new Error("Error this.isInitialized")}}class K{constructor(t){s(this,"onValueChanged");s(this,"_currentValue");s(this,"_previousValue");if(this.onValueChanged=new q,t!==void 0)this._currentValue=t,this._previousValue=t;else throw new Error("Initial value must be provided")}get value(){return this._currentValue}set value(t){this._currentValue=this.onValueChanging(this._currentValue,t),this._previousValue!=this._currentValue&&this.onValueChanged.invoke(this._previousValue,this._currentValue),this._previousValue=this._currentValue}onValueChanging(t,i){return i}refreshValueChanged(){this.onValueChanged.refresh(this._previousValue,this._currentValue)}}class ${constructor(){s(this,"listeners",{})}on(t,i){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(i)}off(t,i){this.listeners[t]&&(this.listeners[t]=this.listeners[t].filter(n=>n!==i))}emit(t,...i){this.listeners[t]&&this.listeners[t].forEach(n=>n(...i))}}class q{constructor(){s(this,"eventEmitter",new $);s(this,"eventName","valueChanged")}addEventListener(t){this.eventEmitter.on(this.eventName,t)}removeEventListener(t){this.eventEmitter.off(this.eventName,t)}invoke(t,i){this.eventEmitter.emit(this.eventName,t,i)}refresh(t,i){this.invoke(t,i)}}class Q{constructor(){s(this,"_isInitialized",!1)}get isInitialized(){return this._isInitialized}async initializeAsync(){if(this.isInitialized)return Promise.resolve();this._isInitialized=!0}requireIsInitialized(){if(!this.isInitialized)throw new Error("Error this.isInitialized")}}export{F as A,Z as B,g as E,U as G,j as M,K as O,N as R,C as S,f as U,d as a,J as b,Q as c,G as d};
